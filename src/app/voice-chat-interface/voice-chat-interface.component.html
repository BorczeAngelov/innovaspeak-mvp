<mat-card class="call-card">
  <mat-card-header>
    <mat-card-title>{{ aiAvatar.name }}</mat-card-title>
    <mat-card-subtitle>{{ aiAvatar.subtitle }}</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content class="content-with-button">

    <img mat-card-image [src]="aiAvatar.imageUri" alt="Illustration representing the AI Avatar"
      style="border-radius: 10%; margin: 10px auto; display: block; max-width: 600px; width: 100%; height: auto;">
    <mat-card-subtitle *ngIf="!isCallStarted">{{ aiAvatar.longText }}</mat-card-subtitle>

    <button mat-raised-button color="accent" (click)="startEmulatedCall()" *ngIf="!isCallStarted">
      <mat-icon>call</mat-icon>
      Start Emulated Call
    </button>

    <button mat-raised-button color="accent" (click)="startCall()" *ngIf="!isCallStarted">
      <mat-icon>call</mat-icon>
      Start Call
    </button>


    <div #messageContainer style="height: 150px; overflow-y: auto;">
      <div *ngFor="let message of messages$ | async"
           [ngStyle]="{'text-align': message.author === 'User' ? 'right' : 'left'}">
           
        <div [ngClass]="message.author === 'User' ? 'message-user-author' : 'message-avatar-author'">
          {{message.author}}
        </div>
        
        <div [ngClass]="message.author === 'User' ? 'user-message' : 'avatar-message'">
          <span>{{ message.text | async }}</span>
        </div>
      </div>
    </div>

    <mat-divider></mat-divider>
  </mat-card-content>

  <mat-card-actions class="ptt-actions">

    <div class="settings-button">
      <button mat-icon-button>
        <mat-icon>settings</mat-icon>
      </button>
    </div>

    <div class="push-to-talk-button">
      <button mat-fab color="primary" class="animated-button" (mousedown)="startTalking()" (mouseup)="stopTalking()">
        <mat-icon>mic</mat-icon>
      </button>
      <span>Push to Talk</span>
    </div>
  </mat-card-actions>

  <mat-card-footer>
    <mat-card-subtitle>Call Duration: <span
        *ngIf="callDuration$ | async as duration">{{duration}}</span></mat-card-subtitle>
    <mat-divider></mat-divider>
    <div class="status-display">
      <ng-container *ngIf="callStatus === 'speaking'; else notSpeaking">
        <mat-icon color="warn">mic</mat-icon>
        <span>User Speaking...</span>
      </ng-container>
      <mat-progress-bar *ngIf="callStatus !== 'idle'" mode="indeterminate"></mat-progress-bar>

      <ng-container>
        <mat-icon color="primary">memory</mat-icon>
        <span>AI Avatar Thinking...</span>
      </ng-container>
      <mat-progress-bar *ngIf="callStatus !== 'idle'" mode="indeterminate"></mat-progress-bar>

      <ng-container>
        <mat-icon color="accent">hearing</mat-icon>
        <span>AI Avatar Talking...</span>
      </ng-container>
      <mat-progress-bar *ngIf="callStatus !== 'idle'" mode="indeterminate"></mat-progress-bar>

      <!-- example below -->
      <ng-template #notSpeaking>
        <ng-container *ngIf="callStatus === 'receiving'; else idle">
          <mat-icon color="accent">hearing</mat-icon>
          <span>Receiving...</span>
        </ng-container>
        <ng-template #idle>
          <mat-icon>phone_in_talk</mat-icon>
          <span>Idle</span>
        </ng-template>
      </ng-template>
    </div>
  </mat-card-footer>
</mat-card>